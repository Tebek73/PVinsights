<div class="results">
  <header class="results-header">
    <h2>Simulation results</h2>
    <p>Review PV yield, key KPIs, cashflow, and insights for your scenario.</p>
  </header>

  <ng-container *ngIf="store.lastResponse() as res; else emptyState">
    <section class="results-kpis">
      <div class="kpi-card">
        <h3>Annual energy</h3>
        <p class="kpi-value">{{ res.kpis.annual_kwh | number: '1.0-0' }} kWh/year</p>
      </div>

      <div class="kpi-card">
        <h3>Specific yield</h3>
        <p class="kpi-value">
          {{ res.kpis.specific_yield_kwh_per_kwp | number: '1.0-0' }} kWh/kWpÂ·year
        </p>
      </div>

      <div class="kpi-card">
        <h3>Capacity factor</h3>
        <p class="kpi-value">{{ res.kpis.capacity_factor_pct | number: '1.1-1' }} %</p>
      </div>

      <div class="kpi-card">
        <h3>Payback</h3>
        <p class="kpi-value">
          <ng-container *ngIf="res.finance.payback_years !== null; else noPayback">
            {{ res.finance.payback_years }} years
          </ng-container>
          <ng-template #noPayback>n/a</ng-template>
        </p>
      </div>

      <div class="kpi-card">
        <h3>Year 1 savings</h3>
        <p class="kpi-value">
          {{ res.finance.savings_year1 | number: '1.0-0' }}
        </p>
      </div>

      <div class="kpi-card">
        <h3>ROI (simple)</h3>
        <p class="kpi-value">
          <ng-container *ngIf="res.finance.roi !== null; else noRoi">
            {{ (res.finance.roi * 100) | number: '1.0-0' }} %
          </ng-container>
          <ng-template #noRoi>n/a</ng-template>
        </p>
      </div>
    </section>

    <section class="results-charts">
      <div class="chart-card">
        <h3>Monthly PV production</h3>
        <div class="chart-bars" *ngIf="monthlyEnergy().length > 0">
          <div
            class="chart-bar-row"
            *ngFor="let m of monthlyEnergy()"
          >
            <span class="chart-bar-label">M{{ m.month }}</span>
            <div class="chart-bar-track">
              <div
                class="chart-bar-fill"
                [style.width.%]="(m.kwh / maxMonthlyEnergy()) * 100"
              ></div>
            </div>
            <span class="chart-bar-value">
              {{ m.kwh | number: '1.0-0' }}
            </span>
          </div>
        </div>
      </div>

      <div class="chart-card">
        <h3>Cumulative cashflow</h3>
        <div class="chart-bars" *ngIf="cashflow().length > 0">
          <div
            class="chart-bar-row"
            *ngFor="let p of cashflow()"
          >
            <span class="chart-bar-label">Y{{ p.year }}</span>
            <div class="chart-bar-track chart-bar-track-cashflow">
              <div
                class="chart-bar-fill chart-bar-fill-cashflow"
                [class.negative]="p.value < 0"
                [style.width.%]="
                  (Math.abs(p.value) / (maxCashflow() || 1)) * 100
                "
              ></div>
            </div>
            <span class="chart-bar-value">
              {{ p.value | number: '1.0-0' }}
            </span>
          </div>
        </div>
      </div>
    </section>

    <section class="results-insights" *ngIf="res.insights.length > 0">
      <h3>Insights</h3>
      <ul>
        <li
          *ngFor="let insight of res.insights"
          [class.warning]="insight.type === 'warning'"
        >
          {{ insight.text }}
        </li>
      </ul>
    </section>
  </ng-container>

  <ng-template #emptyState>
    <section class="results-empty">
      <p>No simulation data yet. Start from the wizard to run your first scenario.</p>
      <button type="button" class="results-button" (click)="backToWizard()">
        Back to wizard
      </button>
    </section>
  </ng-template>
</div>

